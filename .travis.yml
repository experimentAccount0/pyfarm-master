language: python
python:
  - 2.6
  - 2.7

env:
  - TDB_TYPE=sqlite SQLALCHEMY_DATABASE_URI="sqlite:///:memory:"
  - TDB_TYPE=postgres TDB_DRIVER=psycopg2 SQLALCHEMY_DATABASE_URI="postgresql+psycopg2://postgres:@127.0.0.1/pyfarm"
  - TDB_TYPE=postgres TDB_DRIVER=pg8000 SQLALCHEMY_DATABASE_URI="postgresql+pg8000://postgres:@127.0.0.1/pyfarm"
  - TDB_TYPE=mysql TDB_DRIVER=mysql-python SQLALCHEMY_DATABASE_URI="mysql+mysqldb://travis:@127.0.0.1/pyfarm"
  - TDB_TYPE=mysql TDB_DRIVER=pymysql SQLALCHEMY_DATABASE_URI="mysql+pymysql://travis:@127.0.0.1/pyfarm"
  - TDB_TYPE=mysql TDB_DRIVER=mysql-connector-python SQLALCHEMY_DATABASE_URI="mysql+mysqlconnector://travis:@127.0.0.1/pyfarm"

before_script:
  - if [[ $TDB_TYPE == "postgres" ]]; then psql -c "create database pyfarm;" -U postgres; fi
  - if [[ $TDB_TYPE == "mysql" ]]; then mysql -e "create database pyfarm;"; fi

install:
  - if [[ $TRAVIS_PYTHON_VERSION != "2.7" ]]; then pip install unittest2 simplejson --use-mirrors; fi
  - if [[ $TDB_DRIVER != "" ]]; then pip install $TDB_DRIVER; fi
  - pip install coverage --use-mirrors
  - pip install . --use-mirrors

script:
  - pip freeze
  - coverage run --source=pyfarm `which nosetests` -s tests --verbose