{% extends "pyfarm/user_interface/layout.html" %}
{% block title %}Job Groups{% endblock %}
{% block jobgroups_nb_class %}active{% endblock %}
{% block content %}

<table class="table table-striped table-bordered">
  <tr>
    <th>
      <a href="{{ url_for('jobgroups_index_ui', order_by='title', order_dir='asc' if order_dir == 'desc' else 'desc', **filters) }}">
        Title
        {% if order_by == 'title' and order_dir == 'desc' %}
        <span class="glyphicon glyphicon-chevron-down"></span>
        {% elif order_by == 'title' %}
        <span class="glyphicon glyphicon-chevron-up"></span>
        {% endif %}
      </a>
    </th>
    <th>
      <a href="{{ url_for('jobgroups_index_ui', order_by='main_jobtype_name', order_dir='asc' if order_dir == 'desc' else 'desc', **filters) }}">
        Main JobType
        {% if order_by == 'main_jobtype_name' and order_dir == 'desc' %}
        <span class="glyphicon glyphicon-chevron-down"></span>
        {% elif order_by == 'main_jobtype_name' %}
        <span class="glyphicon glyphicon-chevron-up"></span>
        {% endif %}
      </a>
    </th>
    <th>
      Jobs (
      <a href="{{ url_for('jobgroups_index_ui', order_by='j_queued', order_dir='asc' if order_dir == 'desc' else 'desc', **filters) }}">
        queued
        {% if order_by == 'j_queued' and order_dir == 'desc' %}
        <span class="glyphicon glyphicon-chevron-down"></span>
        {% elif order_by == 'j_queued' %}
        <span class="glyphicon glyphicon-chevron-up"></span>
        {% endif %}
      </a>
      /
      <a href="{{ url_for('jobgroups_index_ui', order_by='j_running', order_dir='asc' if order_dir == 'desc' else 'desc', **filters) }}">
        running
        {% if order_by == 'j_running' and order_dir == 'desc' %}
        <span class="glyphicon glyphicon-chevron-down"></span>
        {% elif order_by == 'j_running' %}
        <span class="glyphicon glyphicon-chevron-up"></span>
        {% endif %}
      </a>
      /
      <a href="{{ url_for('jobgroups_index_ui', order_by='j_failed', order_dir='asc' if order_dir == 'desc' else 'desc', **filters) }}">
        failed
        {% if order_by == 'j_failed' and order_dir == 'desc' %}
        <span class="glyphicon glyphicon-chevron-down"></span>
        {% elif order_by == 'j_failed' %}
        <span class="glyphicon glyphicon-chevron-up"></span>
        {% endif %}
      </a>
      /
      <a href="{{ url_for('jobgroups_index_ui', order_by='j_done', order_dir='asc' if order_dir == 'desc' else 'desc', **filters) }}">
        done
        {% if order_by == 'j_done' and order_dir == 'desc' %}
        <span class="glyphicon glyphicon-chevron-down"></span>
        {% elif order_by == 'j_done' %}
        <span class="glyphicon glyphicon-chevron-up"></span>
        {% endif %}
      </a>)
    </th>
    <th>
      <a href="{{ url_for('jobgroups_index_ui', order_by='username', order_dir='asc' if order_dir == 'desc' else 'desc', **filters) }}">
        User
        {% if order_by == 'username' and order_dir == 'desc' %}
        <span class="glyphicon glyphicon-chevron-down"></span>
        {% elif order_by == 'username' %}
        <span class="glyphicon glyphicon-chevron-up"></span>
        {% endif %}
      </a>
    </th>
    <th>
      <a href="{{ url_for('jobgroups_index_ui', order_by='agent_count', order_dir='asc' if order_dir == 'desc' else 'desc', **filters) }}">
        Agents
        {% if order_by == 'agent_count' and order_dir == 'desc' %}
        <span class="glyphicon glyphicon-chevron-down"></span>
        {% elif order_by == 'agent_count' %}
        <span class="glyphicon glyphicon-chevron-up"></span>
        {% endif %}
      </a>
    </th>
    <th>
      <a href="{{ url_for('jobgroups_index_ui', order_by='time_submitted', order_dir='asc' if order_dir == 'desc' else 'desc', **filters) }}">
        Oldest Job
        {% if order_by == 'time_submitted' and order_dir == 'desc' %}
        <span class="glyphicon glyphicon-chevron-down"></span>
        {% elif order_by == 'time_submitted' %}
        <span class="glyphicon glyphicon-chevron-up"></span>
        {% endif %}
      </a>
    </th>
  </tr>
  {% for jobgroup, username, main_jobtype_name, agent_count, time_submitted in jobgroups %}
  <tr>
    <td>
      {{ jobgroup.title }}
    </td>
    <td><a href="{{ url_for('single_jobtype_ui', jobtype_id=jobgroup.main_jobtype_id) }}">{{ main_jobtype_name }}</a></td>
    <td>
      {% for job, jobtype_name in jobs_by_group[jobgroup.id] %}
      {% if not job.state %}
      <span class="glyphicon glyphicon-time" title="{{ job.title }} ({{ jobtype_name }})"></span>
      {% endif %}
      {% if job.state == "running" %}
      <span style="color:#337AB7;">
        <span class="glyphicon glyphicon-play" title="{{ job.title }} ({{ jobtype_name }})"></span>
      </span>
      {% endif %}
      {% if job.state == "done" %}
      <span style="color:#5CB85C">
        <span class="glyphicon glyphicon-ok" title="{{ job.title }} ({{ jobtype_name }})"></span>
      </span>
      {% endif %}
      {% if job.state == "failed" %}
      <span style="color:#D9534F">
        <span class="glyphicon glyphicon-remove" title="{{ job.title }} ({{ jobtype_name }})"></span>
      </span>
      {% endif %}
      {% if job.state == "paused" %}
      <span class="glyphicon glyphicon-pause" title="{{ job.title }} ({{ jobtype_name }})"></span>
      {% endif %}
      {% endfor %}
    </td>
    <td>{{ username }}</td>
    <td>{{ agent_count }}</td>
    <td class="timestamp">{{ time_submitted or '' }}</td>
  </tr>
  {% endfor %}
</table>

{% endblock %}
