{% extends "pyfarm/user_interface/layout.html" %}
{% block title %}Agent {{agent.hostname}} {% endblock %}
{% block agents_nb_class %}active{% endblock %}
{% block additional_scripts %}
<script src="{{ url_for('static', filename='js/agent.js') }}" type="text/javascript"></script>
{% endblock %}
{% block content %}
<h1 style="margin-bottom:20px">{{ agent.hostname }}</h1>
<h4>State</h4>
<table class="table">
  <tbody>
    <tr>
      <td>
        State
      </td>
      <td>
        {{ agent.state }}
      </td>
    </tr>
    <tr>
      <td>
        Last heard from
      </td>
      <td class="timestamp">
        {{ agent.last_heard_from.isoformat() }}
      </td>
    </tr>
    <tr>
      <td>
        OS type
      </td>
      <td>
        {{ agent.os_class or "" }}
      </td>
    </tr>
    <tr>
      <td>
        OS full name
      </td>
      <td>
        {{ agent.os_fullname or "" }}
      </td>
    </tr>
    <tr>
      <td>
        CPU(s)
      </td>
      <td>
        {{ agent.cpu_name or "" }}
      </td>
    </tr>
    <tr>
      <td>
        Cores
      </td>
      <td>
        {{ agent.cpus }}
      </td>
    </tr>
    <tr>
      <td>
        RAM
      </td>
      <td>
        {{ agent.ram }} MiB
      </td>
    </tr>
    <tr>
      <td>
        RAM free
      </td>
      <td>
        {{ agent.free_ram }} MiB
      </td>
    </tr>
    <tr>
      <td>
        GPUs
      </td>
      <td>
        {% for gpu in agent.gpus %}
        {{ gpu.fullname }} <br/>
        {% endfor %}
      </td>
    </tr>
    <tr>
      <td>
        Agent version
      </td>
      <td>
        {{ agent.version }}
      </td>
    </tr>
    <tr>
      <td>
        MAC Addresses
      </td>
      <td>
        {% for mac_address in agent.mac_addresses %}
        {{ mac_address.mac_address }} <br/>
        {% endfor %}
      </td>
    </tr>
  </tbody>
</table>

<h4>Software</h4>
<table class="table">
  <thead>
    <th></th>
    <th>Software</th>
    <th>Version</th>
    <th></th>
  </thead>
  <tbody>
    {% for software_version in agent.software_versions %}
    <tr>
      <td>
        <form style="display: inline;" role="form" method="POST" action="{{ url_for('single_agent_remove_software_ui', agent_id=agent.id, version_id=software_version.id) }}">
          <label for="remove-software-{{software_version.id}}-submit" class="clickable-icon" title="Delete Software Version"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></label>
          <input id="remove-software-{{software_version.id}}-submit" type="submit" class="hidden" onclick="return confirm('Are you sure you want to delete this software version?');"/>
        </form>
      </td>
      <td>{{ software_version.software.software }}</td>
      <td>{{ software_version.version }}</td>
      <td></td>
    </tr>
    {% endfor %}
    <tr>
      <form method="POST" action="{{ url_for('single_agent_add_software_ui', agent_id=agent.id) }}">
        <td></td>
        <td>
          <select class="form-control" id="add_software_sw" name="software">
            <option></option>
            {% for software in software_items %}
            <option value="{{ software.id }}">{{ software.software }}</option>
            {% endfor %}
          </select>
        </td>
        <td>
          <select class="form-control" id="add_software_version" name="version">
          </select>
        </td>
        <td>
          <input type="submit" class="btn" value="Add"/>
        </td>
      </form>
    </tr>
  </tbody>
</table>

<h4>Tasks</h4>
<table class="table">
  <thead>
    <th>ID</th>
    <th>Frame</th>
    <th>Job</th>
    <th>State</th>
  </thead>
  <tbody>
    {% for task in tasks %}
    <tr>
      <td>{{ task.id }}</td>
      <td>{{ task.frame }}</td>
      <td><a href="{{ url_for('single_job_ui', job_id=task.job.id) }}"> {{ task.job.title }} (ID {{ task.job.id }})</a></td>
      <td>{{ task.state }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<h4>Recent Tasklogs</h4>
<table class="table">
  <thead>
    <th>Identifier</th>
    <th>Created On</th>
    <th>Job</th>
    <th>Jobtype</th>
  </thead>
  <tbody>
    {% for tasklog in tasklogs %}
    <tr>
      <td><a href="/api/v1/jobs/{{ tasklog.task.job.id }}/tasks/{{ tasklog.task.id }}/attempts/{{ tasklog.attempt }}/logs/{{ tasklog.identifier }}/logfile">{{ tasklog.identifier }}</a></td>
      <td class="timestamp">{{ tasklog.created_on.isoformat() }}</td>
      <td><a href="{{ url_for('single_job_ui', job_id=tasklog.task.job.id) }}">{{ tasklog.task.job.title }}</a></td>
      <td><a href="{{ url_for('single_jobtype_ui', jobtype_id=tasklog.task.job.jobtype_version.jobtype.id) }}">{{ tasklog.task.job.jobtype_version.jobtype.name }}</a> Version {{ tasklog.task.job.jobtype_version.version }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
