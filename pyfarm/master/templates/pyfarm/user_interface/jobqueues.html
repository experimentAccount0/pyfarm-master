{% extends "pyfarm/user_interface/layout.html" %}
{% block title %}Queues{% endblock %}
{% block jobqueues_nb_class %}active{% endblock %}
{% block content %}

<div class="tree">
<ul>
  {% for queue in jobqueues.order_by("priority desc") recursive %}
  <li>
    <span>
      <i class="glyphicon glyphicon-minus-sign"></i>{{ queue.path() }}
      <p>
        Agents min / current / max: {{ queue.minimum_agents or "-"}} / {{ queue.num_assigned_agents() }} / {{ queue.maximum_agents or "-" }}<br/>
        Priority: {{ queue.priority }}<br/>
        Weight: {{ queue.weight }}
      </p>
    </span>
    <a href="{{ url_for('single_jobqueue_ui', queue_id=queue.id) }}" title="Edit Queue">
      <i class="glyphicon glyphicon-pencil"></i>
    </a>
    <form style="display: inline;" role="form" method="POST" action="{{ url_for('delete_jobqueue_ui', queue_id=queue.id) }}">
      <label for="remove-queue-{{queue.id}}-submit" class="clickable-icon" title="Delete Jobqueue"><i class="glyphicon glyphicon-trash" aria-hidden="true"></i></label>
      <input id="remove-queue-{{queue.id}}-submit" type="submit" class="hidden" onclick="return confirm('Are you sure you want to delete this jobqueue?');"/>
    </form>
    {% if queue.children or queue.jobs.count() != 0 %}
    <ul>
      {{ loop(queue.children) }}
      <li><a href="{{ url_for('jobqueue_create_ui', parent=queue.id) }}" class="btn btn-default" role="button">Create Subqueue</a></li>
      {% for job in queue.jobs.order_by("state desc") %}
      <li>
        <div class="panel {{ 'panel-success' if job.state == WorkState.DONE }} {{ 'panel-danger' if job.state == WorkState.FAILED }} {{ 'panel-default' if job.state == None }} {{ 'panel-info' if job.state == WorkState.RUNNING }} {{ 'panel-warning' if job.state == WorkState.PAUSED }}" style="max-width:50%;margin-bottom:0">
          <div class="panel-heading"><h3 class="panel-title">{{ job.title }}</h3></div>
          <div class="panel-body">
            <a style="float:right" href="{{ url_for('single_job_ui', job_id=job.id) }}" title="View Job">
              <i class="glyphicon glyphicon-eye-open"></i>
            </a>
            State: {{ job.state or "queued" }}<br/>
            Agents min / current / max: {{ job.minimum_agents or "-"}} / {{ job.num_assigned_agents() }} / {{ job.maximum_agents or "-" }}<br/>
            Priority: {{ job.priority }}<br/>
            Weight: {{ job.weight }}<br/>
          </div>
        </div>
      </li>
      {% endfor %}
    </ul>
    {% endif %}
  </li>
  {% endfor %}
  <li><a href="{{ url_for('jobqueue_create_ui') }}" class="btn btn-default" role="button">Create</a></li>
  {% for job in top_level_jobs %}
  <li>
    <div class="panel {{ 'panel-success' if job.state == WorkState.DONE }} {{ 'panel-danger' if job.state == WorkState.FAILED }} {{ 'panel-default' if job.state == None }} {{ 'panel-info' if job.state == WorkState.RUNNING }} {{ 'panel-warning' if job.state == WorkState.PAUSED }}" style="max-width:50%;margin-bottom:0">
      <div class="panel-heading"><h3 class="panel-title">{{ job.title }}</h3></div>
      <div class="panel-body">
        <a style="float:right" href="{{ url_for('single_job_ui', job_id=job.id) }}" title="View Job">
          <i class="glyphicon glyphicon-eye-open"></i>
        </a>
        State: {{ job.state or "queued" }}<br/>
        Agents min / current / max: {{ job.minimum_agents or "-"}} / {{ job.num_assigned_agents() }} / {{ job.maximum_agents or "-" }}<br/>
        Priority: {{ job.priority }}<br/>
        Weight: {{ job.weight }}<br/>
      </div>
    </div>
  </li>
  {% endfor %}
</ul>
</div>
{% endblock %}
